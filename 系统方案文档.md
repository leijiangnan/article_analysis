# 文章分析管理系统 - 技术方案文档

## 1. 项目概述

### 1.1 项目背景
构建一个前后端分离的文章分析管理系统，支持文章上传、分类存储、搜索展示，并通过OpenAI API进行文章深度分析。

### 1.2 核心功能
- 文章上传与作者分类存储
- 文章列表展示与搜索
- 文章智能分析（调用OpenAI API）
- 分析结果展示与管理

## 2. 系统架构

### 2.1 架构模式
采用前后端分离架构：
- 前端：Vue 3 + Element Plus + Vite
- 后端：Go + Gin框架 + GORM
- 数据库：MySQL
- 文件存储：本地文件系统
- AI服务：OpenAI API

### 2.2 系统架构图
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Vue前端       │    │   Go后端        │    │   MySQL数据库   │
│                 │◄──►│                 │◄──►│                 │
│ - 文件上传      │    │ - API接口       │    │ - 文章数据      │
│ - 列表展示      │    │ - 业务逻辑      │    │ - 分析结果      │
│ - 搜索功能      │    │ - OpenAI调用    │    │ - 用户数据      │
│ - 分析结果展示  │    │ - 文件处理      │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │
                              ▼
                       ┌─────────────────┐
                       │   OpenAI API    │
                       │                 │
                       │ - 文章分析      │
                       │ - 内容拆解      │
                       └─────────────────┘
```

## 3. 技术选型

### 3.1 前端技术栈
- **框架**: Vue 3.3+
- **UI组件库**: Element Plus
- **构建工具**: Vite
- **路由**: Vue Router 4
- **状态管理**: Pinia
- **HTTP客户端**: Axios
- **代码规范**: ESLint + Prettier

### 3.2 后端技术栈
- **语言**: Go 1.21+
- **Web框架**: Gin
- **ORM框架**: GORM
- **数据库**: MySQL 8.0
- **配置文件**: Viper
- **日志**: Zap
- **验证**: Validator
- **API文档**: Swagger

### 3.3 第三方服务
- **AI分析**: OpenAI GPT API
- **文件存储**: 本地文件系统

## 4. 数据库设计

### 4.1 数据表结构

#### 4.1.1 文章表 (articles)
```sql
CREATE TABLE articles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(500) NOT NULL COMMENT '文章标题',
    author VARCHAR(200) NOT NULL COMMENT '作者',
    content TEXT NOT NULL COMMENT '文章内容',
    file_path VARCHAR(500) NOT NULL COMMENT '文件存储路径',
    file_size BIGINT NOT NULL COMMENT '文件大小(字节)',
    upload_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '上传时间',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_author (author),
    INDEX idx_upload_time (upload_time),
    FULLTEXT idx_title_content (title, content)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文章表';
```

#### 4.1.2 文章分析结果表 (article_analyses)
```sql
CREATE TABLE article_analyses (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    article_id BIGINT NOT NULL COMMENT '文章ID',
    core_viewpoints TEXT COMMENT '核心观点',
    file_structure TEXT COMMENT '文件结构',
    author_thoughts TEXT COMMENT '作者思路',
    related_materials TEXT COMMENT '相关素材与事例',
    analysis_status ENUM('pending', 'processing', 'completed', 'failed') DEFAULT 'pending' COMMENT '分析状态',
    analysis_time TIMESTAMP NULL COMMENT '分析完成时间',
    error_message TEXT COMMENT '错误信息',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE,
    INDEX idx_article_id (article_id),
    INDEX idx_status (analysis_status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文章分析结果表';
```

## 5. API接口设计

### 5.1 接口规范
- **协议**: HTTP/HTTPS
- **数据格式**: JSON
- **字符编码**: UTF-8
- **接口版本**: v1
- **统一响应格式**:
```json
{
    "code": 200,
    "message": "success",
    "data": {},
    "timestamp": 1700000000
}
```

### 5.2 接口列表

#### 5.2.1 文章管理接口

**1. 上传文章**
```
POST /api/v1/articles/upload
Content-Type: multipart/form-data

参数:
- file: 文件 (必填, .txt格式)
- title: 文章标题 (选填)
- author: 作者 (选填)

响应:
{
    "code": 200,
    "message": "上传成功",
    "data": {
        "id": 1,
        "title": "文章标题",
        "author": "作者名",
        "upload_time": "2024-01-01 12:00:00"
    }
}
```

**2. 获取文章列表**
```
GET /api/v1/articles
参数:
- page: 页码 (默认1)
- page_size: 每页条数 (默认10)
- keyword: 搜索关键词 (选填)
- author: 作者筛选 (选填)
- sort: 排序字段 (upload_time, title)
- order: 排序方式 (asc, desc)

响应:
{
    "code": 200,
    "message": "success",
    "data": {
        "total": 100,
        "page": 1,
        "page_size": 10,
        "list": [
            {
                "id": 1,
                "title": "文章标题",
                "author": "作者名",
                "upload_time": "2024-01-01 12:00:00",
                "has_analysis": true
            }
        ]
    }
}
```

**3. 获取文章详情**
```
GET /api/v1/articles/{id}

响应:
{
    "code": 200,
    "message": "success",
    "data": {
        "id": 1,
        "title": "文章标题",
        "author": "作者名",
        "content": "文章内容...",
        "upload_time": "2024-01-01 12:00:00",
        "file_size": 1024
    }
}
```

#### 5.2.2 文章分析接口

**1. 提交文章分析**
```
POST /api/v1/articles/{id}/analyze

响应:
{
    "code": 200,
    "message": "分析任务已提交",
    "data": {
        "task_id": "task_123456",
        "status": "processing"
    }
}
```

**2. 获取分析结果**
```
GET /api/v1/articles/{id}/analysis

响应:
{
    "code": 200,
    "message": "success",
    "data": {
        "id": 1,
        "article_id": 1,
        "core_viewpoints": "核心观点内容...",
        "file_structure": "文件结构描述...",
        "author_thoughts": "作者思路分析...",
        "related_materials": "相关素材与事例...",
        "analysis_status": "completed",
        "analysis_time": "2024-01-01 13:00:00"
    }
}
```

**3. 获取分析任务状态**
```
GET /api/v1/analysis/status/{task_id}

响应:
{
    "code": 200,
    "message": "success",
    "data": {
        "task_id": "task_123456",
        "status": "completed",
        "progress": 100
    }
}
```

### 5.3 错误码定义
```
200 - 成功
400 - 请求参数错误
401 - 未授权
403 - 权限不足
404 - 资源不存在
422 - 业务逻辑错误
500 - 服务器内部错误
503 - 服务不可用
```

## 6. 前端页面设计

### 6.1 页面结构
```
src/
├── components/          # 公共组件
│   ├── ArticleList.vue
│   ├── ArticleDetail.vue
│   ├── AnalysisResult.vue
│   └── FileUpload.vue
├── views/              # 页面视图
│   ├── Dashboard.vue   # 仪表板
│   ├── ArticleList.vue # 文章列表
│   └── ArticleDetail.vue # 文章详情
├── api/                # API接口
├── router/             # 路由配置
├── store/              # 状态管理
└── utils/              # 工具函数
```

### 6.2 主要页面

#### 6.2.1 文章列表页面
- 文章表格展示（标题、作者、上传时间、分析状态）
- 搜索功能（按标题、作者、内容）
- 文件上传功能
- 分析操作按钮

#### 6.2.2 文章详情页面
- 文章内容展示
- 基本信息展示
- 分析结果展示（如果已分析）
- 重新分析按钮

#### 6.2.3 分析结果页面
- 核心观点展示
- 文件结构展示
- 作者思路展示
- 相关素材与事例展示

## 7. 后端服务设计

### 7.1 服务结构
```
cmd/
├── main.go             # 主程序入口
internal/
├── handler/            # HTTP处理器
│   ├── article.go
│   └── analysis.go
├── service/            # 业务逻辑
│   ├── article.go
│   └── analysis.go
├── repository/         # 数据访问
│   ├── article.go
│   └── analysis.go
├── model/              # 数据模型
├── config/             # 配置管理
├── middleware/         # 中间件
└── utils/              # 工具函数
```

### 7.2 核心功能模块

#### 7.2.1 文件处理模块
- TXT文件读取与解析
- 文件大小检查
- 文件类型验证
- 文件存储管理

#### 7.2.2 文章管理模块
- 文章CRUD操作
- 作者自动识别
- 搜索功能实现
- 分页查询

#### 7.2.3 AI分析模块
- OpenAI API集成
- 分析任务队列
- 结果解析与存储
- 错误处理与重试

## 8. 部署方案

### 8.1 开发环境
```bash
# 前端开发
npm install
npm run dev

# 后端开发
go mod tidy
go run cmd/main.go
```

### 8.2 生产部署
- **前端**: 构建静态文件，部署到Nginx
- **后端**: 编译二进制文件，使用systemd管理
- **数据库**: MySQL主从配置
- **负载均衡**: Nginx反向代理

### 8.3 环境配置
```yaml
# 配置文件示例
database:
  host: localhost
  port: 3306
  username: root
  password: password
  database: article_analysis

openai:
  api_key: your_api_key
  model: gpt-3.5-turbo
  max_tokens: 2000

server:
  port: 8080
  mode: release
```

## 9. 开发计划

### 9.1 第一阶段（基础功能）
- [ ] 项目初始化与环境搭建
- [ ] 数据库设计与初始化
- [ ] 基础API接口开发
- [ ] 文件上传功能
- [ ] 文章列表展示

### 9.2 第二阶段（核心功能）
- [ ] 搜索功能实现
- [ ] OpenAI API集成
- [ ] 文章分析功能
- [ ] 分析结果展示

### 9.3 第三阶段（优化完善）
- [ ] 性能优化
- [ ] 错误处理完善
- [ ] 日志系统
- [ ] 单元测试
- [ ] 部署配置

## 10. 技术风险与解决方案

### 10.1 技术风险
1. **OpenAI API调用限制**: 请求频率和配额限制
2. **大文件处理**: 内存占用和性能问题
3. **数据库性能**: 全文搜索性能
4. **并发处理**: 多用户同时分析

### 10.2 解决方案
1. **API限制**: 实现请求队列和重试机制
2. **文件处理**: 分块读取和处理大文件
3. **搜索优化**: 使用数据库索引和缓存
4. **并发处理**: 使用goroutine池和任务队列

## 11. 后续扩展计划

### 11.1 功能扩展
- 支持更多文件格式（PDF、Word等）
- 批量分析功能
- 分析结果导出
- 用户权限管理
- 数据统计分析

### 11.2 技术优化
- 引入Redis缓存
- 实现分布式部署
- 添加监控告警
- 性能调优

---

**文档版本**: v1.0  
**创建时间**: 2024年  
**最后更新**: 2024年